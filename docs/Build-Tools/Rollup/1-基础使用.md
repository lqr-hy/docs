# Rollup
Rollup 是一个 JavaScript 模块打包器，它能够帮助你将多个模块（通常是 ES6 模块）打包成一个小巧、优雅的文件，适用于浏览器或 Node.js。Rollup 的特点是支持树摇优化（Tree Shaking），可以去掉未使用的代码，并生成高效、紧凑的包。

下面是使用 Rollup 的一些基本步骤和示例代码：

### 1. 安装 Rollup
首先，你需要在项目中安装 Rollup 以及一些常用的插件。

```bash
npm install --save-dev rollup @rollup/plugin-node-resolve @rollup/plugin-commonjs @rollup/plugin-babel rollup-plugin-terser
```

### 2. 创建 Rollup 配置文件

创建一个 `rollup.config.js` 文件，这是 Rollup 的配置文件，用来定义打包的入口、输出和插件。

```javascript
import resolve from '@rollup/plugin-node-resolve'; // 支持加载第三方模块
import commonjs from '@rollup/plugin-commonjs';   // 支持 CommonJS 模块
import { terser } from 'rollup-plugin-terser';    // 代码压缩插件
import babel from '@rollup/plugin-babel';         // Babel 插件

export default {
  input: 'src/index.js',   // 入口文件
  output: {
    file: 'dist/bundle.js', // 输出文件
    format: 'cjs',          // 输出格式: CommonJS (cjs), ES module (esm), IIFE, UMD, etc.
  },
  plugins: [
    resolve(),    // 解析 node_modules 中的依赖
    commonjs(),   // 转换 CommonJS 模块为 ES6
    babel({       // 使用 Babel 转译
      exclude: 'node_modules/**',
      babelHelpers: 'bundled'
    }),
    terser()      // 压缩代码
  ]
};
```

### 3. 创建入口文件

在 `src/index.js` 中编写你的代码，这是 Rollup 的入口文件：

```javascript
import { sum } from './utils';

console.log(sum(1, 2)); // 3
```

并在 `src/utils.js` 中创建一个简单的实用函数：

```javascript
export function sum(a, b) {
  return a + b;
}
```

### 4. 运行 Rollup

在 `package.json` 中添加一个脚本来运行 Rollup：

```json
{
  "scripts": {
    "build": "rollup -c"
  }
}
```

然后，运行以下命令来打包代码：

```bash
npm run build
```

执行后，Rollup 会根据配置文件打包代码，并将结果输出到 `dist/bundle.js` 中。你可以在 Node.js 环境或浏览器中使用打包后的文件。

### 5. 支持 ES 模块和 CommonJS 模块

你可以同时生成 ES 模块和 CommonJS 模块：

```javascript
export default {
  input: 'src/index.js',
  output: [
    {
      file: 'dist/bundle.esm.js',
      format: 'esm' // ES Module 格式
    },
    {
      file: 'dist/bundle.cjs.js',
      format: 'cjs' // CommonJS 格式
    }
  ],
  plugins: [
    resolve(),
    commonjs(),
    babel({ 
      exclude: 'node_modules/**',
      babelHelpers: 'bundled'
    }),
    terser()
  ]
};
```

### 6. 使用 Watch 模式

在开发过程中，可以使用 `--watch` 选项让 Rollup 在文件变化时自动重新打包：

```bash
npx rollup -c --watch
```

### 7. 使用 TypeScript

如果你想在项目中使用 TypeScript，还可以安装 `@rollup/plugin-typescript` 插件：

```bash
npm install --save-dev @rollup/plugin-typescript typescript
```

然后在 `rollup.config.js` 中添加 TypeScript 插件：

```javascript
import typescript from '@rollup/plugin-typescript';

export default {
  input: 'src/index.ts',
  output: {
    file: 'dist/bundle.js',
    format: 'cjs'
  },
  plugins: [
    resolve(),
    commonjs(),
    typescript(), // 添加 TypeScript 插件
    terser()
  ]
};
```

并将入口文件改为 TypeScript：

```typescript
import { sum } from './utils';

console.log(sum(1, 2));
```

### 8. 开启本地服务

如果你想在浏览器中打开打包后资源，还可以安装 `rollup-plugin-serve` 插件：

```bash
npm install --save-dev rollup-plugin-serve
```

然后在 `rollup.config.js` 中添加 TypeScript 插件：

```javascript
import serve from 'rollup-plugin-serve';

export default {
  input: 'src/index.ts',
  output: {
    file: 'dist/bundle.js',
    format: 'cjs'
  },
  plugins: [
    resolve(),
    commonjs(),
    typescript(), // 添加 TypeScript 插件
    terser(),
    serve({
      open: true,
      port: 8080,
      contentBase: './dist'
    })
  ]
};
```

 在 `package.json` 中添加一个脚本来运行 Rollup：

```json
{
  "scripts": {
    "build": "rollup -c",
    "dev": "rollup --config rollup.config.js -w"
  }
}
```
