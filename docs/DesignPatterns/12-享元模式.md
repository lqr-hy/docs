# 享元模式

- 享元模式（Flyweight Pattern）是一种结构型设计模式，旨在减少系统中对象的数量，以节省内存和提高性能。该模式通过共享相似对象的部分状态来实现这一目标，从而减少内存使用。

在享元模式中，存在两种类型的状态：内部状态（Intrinsic State）和外部状态（Extrinsic State）。内部状态是可以共享的，它包含对象共享的属性；而外部状态是不可共享的，它取决于具体的场景，每个对象都需要单独存储。

享元模式的关键是将对象的状态划分为内部状态和外部状态，并确保内部状态可以被多个对象共享。当一个新对象需要创建时，首先检查是否已经存在具有相同内部状态的对象，如果存在，则共享现有对象，否则创建一个新对象。

1. **_优点：_**

   - **减少内存消耗：** 享元模式通过共享相似对象的部分状态来减少内存消耗，因为相似对象的内部状态可以被多个对象共享，而不是每个对象都单独保存一份。
   - **提高性能：** 减少对象数量可以降低系统的负载，提高系统的性能和响应速度。因为系统中需要处理的对象数量减少，操作和处理的时间也相应减少。
   - **简化对象结构：** 享元模式将对象的状态划分为内部状态和外部状态，使得对象结构更加清晰，有利于降低系统的复杂度。

2. **_缺点：_**

   - **增加复杂性：** 实现享元模式需要对对象的状态进行细致划分，可能会增加系统的复杂性，尤其是在管理共享对象的生命周期和状态变化时。
   - **不适用于所有情况：** 享元模式适用于具有大量相似对象的场景，对于不需要共享状态的对象或者状态变化频繁的对象，不适合使用享元模式。

3. **_适用场景：_**

   - **大量相似对象：** 适用于系统中存在大量相似对象的场景，这些对象的区别仅在于部分状态的情况。例如文本编辑器中的字符对象、游戏中的粒子对象等。
   - **需要频繁创建和销毁对象：** 当系统需要频繁创建和销毁对象时，可以考虑使用享元模式。通过共享对象，可以减少对象的创建和销毁次数，提高系统的性能和资源利用率。
   - **系统需要提高性能：** 当系统需要提高性能并减少内存消耗时，可以考虑使用享元模式。通过共享相似对象的部分状态，可以减少内存消耗，提高系统的性能和响应速度。

:::details demo

```typescript
// 图片类
class Image {
  constructor(private src: string) {}

  display(x: number, y: number): void {
    console.log(`显示图片 ${this.src} 在 (${x}, ${y})`)
  }
}

// 图片工厂，负责管理图片对象
class ImageFactory {
  private images: { [key: string]: Image } = {}

  getImage(src: string): Image {
    if (!this.images[src]) {
      this.images[src] = new Image(src)
    }
    return this.images[src]
  }
}

// 使用示例
const imageFactory = new ImageFactory()
const image1 = imageFactory.getImage('image1.jpg')
const image2 = imageFactory.getImage('image1.jpg') // 从工厂获取相同的图片对象
const image3 = imageFactory.getImage('image2.jpg')

image1.display(10, 20) // 输出: 显示图片 image1.jpg 在 (10, 20)
image2.display(30, 40) // 输出: 显示图片 image1.jpg 在 (30, 40) - 与 image1 共享同一个对象
image3.display(50, 60) // 输出: 显示图片 image2.jpg 在 (50, 60)
```

在这个示例中，我们通过 `ImageFactory` 管理图片对象，并使用享元模式共享相同的图片对象。当用户需要插入相同的图片时，我们从工厂获取已存在的图片对象，而不是创建新的对象，从而节省了内存。
::;
