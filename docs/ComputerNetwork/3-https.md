# HTTPS

HTTPS（HyperText Transfer Protocol Secure）是HTTP的安全版本，通过在HTTP和TCP之间加入SSL/TLS层来提供数据加密和安全性。以下是HTTPS连接的详细过程，包括使用对称加密和非对称加密的阶段：

### 1. HTTPS 连接建立过程

#### 1.1 客户端发起请求（Client Hello）

- **客户端**发送一个Client Hello消息给服务器。该消息包含以下信息：
  - 支持的SSL/TLS版本。
  - 支持的加密算法套件。
  - 客户端生成的随机数。

#### 1.2 服务器响应（Server Hello）

- **服务器**接收到Client Hello消息后，回复一个Server Hello消息，其中包含：
  - 服务器选择的SSL/TLS版本和加密算法套件。
  - 服务器生成的随机数。
  - 服务器的数字证书（包含公钥）。

#### 1.3 证书验证

- **客户端**验证服务器的数字证书，确保证书有效且服务器可信。如果验证失败，连接终止；如果验证成功，继续进行。

#### 1.4 密钥交换（使用非对称加密）

- **客户端**生成一个预主密钥（Pre-Master Secret），并使用服务器的公钥加密该预主密钥，然后发送给服务器。

```plaintext
客户端：Pre-Master Secret (使用服务器公钥加密)
```

- **服务器**接收到加密的预主密钥后，使用自己的私钥解密，得到预主密钥。

#### 1.5 会话密钥生成（对称加密）

- **客户端和服务器**使用预主密钥和双方生成的随机数，经过密钥导出函数（Key Derivation Function, KDF）生成会话密钥。

```plaintext
会话密钥 = KDF(Pre-Master Secret + 客户端随机数 + 服务器随机数)
```

### 2. 加密通信过程

#### 2.1 数据加密和传输

- **客户端和服务器**使用生成的会话密钥对通信数据进行对称加密。

```plaintext
加密数据 = 对称加密(明文数据, 会话密钥)
```

- 加密后的数据通过网络传输，接收方使用相同的会话密钥进行解密，恢复原始数据。

#### 2.2 数据解密

- **接收方**使用会话密钥对接收到的数据进行解密，得到明文数据。

### HTTPS 连接过程示意图

1. **客户端发起请求**
   - Client Hello: 支持的SSL/TLS版本, 加密算法套件, 客户端随机数
2. **服务器响应**
   - Server Hello:  服务器选择的SSL/TLS版本, 加密算法套件, 服务器随机数, 数字证书
3. **证书验证**
   - 客户端验证服务器的数字证书。
4. **密钥交换**
   - 客户端生成预主密钥，并使用服务器公钥加密发送。
   - 服务器使用私钥解密预主密钥。
5. **会话密钥生成**
   - 客户端和服务器生成会话密钥。
6. **数据传输**
   - 使用会话密钥进行对称加密传输数据。

### 3. HTTPS 连接总结

- **非对称加密**：用于密钥交换阶段，确保预主密钥的安全传输。非对称加密算法通常包括RSA、ECDHE等。
- **对称加密**：用于数据传输阶段，确保数据的机密性和完整性。对称加密算法通常包括AES、DES等。