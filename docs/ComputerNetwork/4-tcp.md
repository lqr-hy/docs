# TCP

TCP（Transmission Control Protocol）是一个面向连接的、可靠的传输层协议，用于在计算机网络中传输数据。建立一个 TCP 连接的过程通常称为 "三次握手"（Three-Way Handshake）。以下是 TCP 连接的详细过程：

### 1. 三次握手（Three-Way Handshake）

三次握手是建立 TCP 连接的过程，确保客户端和服务器都准备好进行数据传输。具体步骤如下：

#### 1.1 客户端发送 SYN（同步序列编号）

- **客户端（Client）**：发送一个 SYN 包（SYN=1），包括初始序列号（Sequence Number，通常简写为 SEQ）。
- **目的**：请求建立连接，告诉服务器客户端的初始序列号。

```plaintext
Client: SYN=1, SEQ=x
```

#### 1.2 服务器响应 SYN-ACK（同步-确认）

- **服务器（Server）**：收到 SYN 包后，发送一个 SYN-ACK 包，SYN=1 和 ACK=1，包含服务器的初始序列号和对客户端 SYN 包的确认号（Acknowledgment Number，通常简写为 ACK）。
- **目的**：确认收到客户端的 SYN 包，并发送自己的 SYN 请求。

```plaintext
Server: SYN=1, ACK=1, SEQ=y, ACK=x+1
```

#### 1.3 客户端发送 ACK（确认）

- **客户端（Client）**：收到服务器的 SYN-ACK 包后，发送一个 ACK 包，ACK=1，包含对服务器 SYN 包的确认号。
- **目的**：确认收到服务器的 SYN 包，建立连接。

```plaintext
Client: ACK=1, SEQ=x+1, ACK=y+1
```

### 2. 数据传输

三次握手完成后，客户端和服务器之间可以开始数据传输。数据传输的过程包括以下步骤：

#### 2.1 数据分段

- **分段**：将数据分成多个段，每个段都有一个序列号。
- **发送**：每个段包含数据和序列号，通过 TCP 连接发送。

#### 2.2 确认和重传

- **确认（ACK）**：接收方收到数据段后，发送一个确认包，包含接收到的数据段的下一个序列号。
- **重传**：如果发送方在一定时间内没有收到确认包，会重传未确认的数据段。

### 3. 四次挥手（Four-Way Handshake）

四次挥手是关闭 TCP 连接的过程，确保双方都完成数据传输。具体步骤如下：

#### 3.1 客户端发送 FIN（结束）

- **客户端（Client）**：发送一个 FIN 包（FIN=1），表示数据传输结束，请求关闭连接。
- **目的**：告诉服务器客户端的数据传输已经完成。

```plaintext
Client: FIN=1, SEQ=u
```

#### 3.2 服务器响应 ACK（确认）

- **服务器（Server）**：收到 FIN 包后，发送一个 ACK 包，确认收到 FIN 请求。
- **目的**：确认收到客户端的 FIN 包。

```plaintext
Server: ACK=1, SEQ=v, ACK=u+1
```

#### 3.3 服务器发送 FIN（结束）

- **服务器（Server）**：发送一个 FIN 包（FIN=1），表示服务器的数据传输也结束，请求关闭连接。
- **目的**：告诉客户端服务器的数据传输已经完成。

```plaintext
Server: FIN=1, SEQ=w
```

#### 3.4 客户端响应 ACK（确认）

- **客户端（Client）**：收到服务器的 FIN 包后，发送一个 ACK 包，确认收到 FIN 请求。
- **目的**：确认收到服务器的 FIN 包，关闭连接。

```plaintext
Client: ACK=1, SEQ=u+1, ACK=w+1
```

### 总结

TCP 连接的详细过程可以总结为以下几个步骤：

1. **三次握手**：

   - **客户端发送 SYN 包**：请求建立连接，发送初始序列号。
   - **服务器响应 SYN-ACK 包**：确认收到客户端的 SYN 包，并发送服务器的初始序列号。
   - **客户端发送 ACK 包**：确认收到服务器的 SYN 包，连接建立。

2. **数据传输**：

   - **数据分段和发送**：将数据分成多个段，每个段都有序列号，通过 TCP 连接发送。
   - **确认和重传**：接收方发送确认包，发送方根据确认包重传未确认的数据段。

3. **四次挥手**：
   - **客户端发送 FIN 包**：请求关闭连接，表示数据传输结束。
   - **服务器响应 ACK 包**：确认收到客户端的 FIN 请求。
   - **服务器发送 FIN 包**：表示服务器的数据传输也结束。
   - **客户端响应 ACK 包**：确认收到服务器的 FIN 请求，连接关闭。
